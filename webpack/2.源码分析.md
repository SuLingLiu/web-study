# 源码分析
## 如何取文件中的依赖
* 不推荐使用字符串截取，引入的模块名越多，就越麻烦，不灵活，推荐使用@babel/parser，这是babel7的工具，帮助分析内部的语法，包括es6，返回一个ast抽象语法树

@babel/parser: [babel-parser](https://babeljs.io/docs/en/babel-parser)
`npm i @babel/parser --save`
``` js
const fs = require("fs")
const parser = require("@babel/parser")

const entry = (entryFile) => {
    const content = fs.readFileSync(entryFile,"utf-8")
    const ast = parser.parse(content, {
        sourceType: "module"
    })
    console.log(ast.program.body)
}
entry("./src/index.js")
```
* 可以根据body里面的分析结果，遍历出所有的引入模块，但是比较麻烦，这里推荐babel推荐的一个模块@babel/traverse，来处理
`npm i @babel/traverse --save`
``` js
const path = require("path")
const fs = require("fs")
const parser = require("@babel/parser")
const traverse = require("@babel/traverse").default


const entry = (entryFile) => {
    const content = fs.readFileSync(entryFile,"utf-8")
    const ast = parser.parse(content, {
        sourceType: "module"
    })
    const dependecies = {};
    traverse(ast, {
        //以函数的形式
        ImportDeclaration({node}) {
            const dirname = path.dirname(entryFile)//会分析入口文件的目录 ./src
            const value = node.source.value
            
            console.log(dirname,value)
            let newPath = "./" + path.join(dirname,value)
            newPath = newPath.replace('\\', '/')
            dependecies[value] = newPath
        }
    })

    console.log(dependecies)
}

entry("./src/index.js")

```
* 把代码处理成浏览器可以运行的代码，需要借助@babel/core，和@babel/preset-env，把ast语法树转换成合适的代码
`npm i @babel/core @babel/preset-env -S`



